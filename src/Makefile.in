###########################################################################
# ALPS library
#
# src/Makefile.in
#
# $Id$
#
# Copyright (C) 1994-2004 by Matthias Troyer <troyer@comp-phys.org>,
#                            Synge Todo <wistaria@comp-phys.org>,
#
# This software is part of the ALPS library, published under the 
# ALPS Library License; you can use, redistribute it and/or modify 
# it under the terms of the License, either version 1 or (at your option) 
# any later version.
#
# You should have received a copy of the ALPS Library License along with 
# the ALPS Library; see the file License.txt. If not, the license is also 
# available from http://alps.comp-phys.org/. 
#
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR 
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
# FITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT 
# SHALL THE COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE 
# FOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN CONTRACT, TORT OR OTHERWISE, 
# ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
# DEALINGS IN THE SOFTWARE.
#
###########################################################################

# directories
srcdir = @srcdir@
top_srcdir = @top_srcdir@
builddir = @builddir@
top_builddir = ./@top_builddir@

include $(top_srcdir)/config/include-build.mk

pkgincludedir = $(includedir)

HEADER_CONFIG = alps/config.h @BOOST_USER_CONFIG_H@
HEADER_BOOST = boost/depth_first_search_2.hpp boost/function_objects.hpp
HEADER_ALPS = alps/bitops.h alps/cctype.h alps/evaluator.h alps/expression.h alps/expression_impl.h alps/factory.h alps/functional.h alps/math.hpp alps/multi_array.hpp alps/parameterlist.h alps/parameters.h alps/plot.h alps/random.h alps/stringvalue.h alps/typetraits.h alps/vectorio.h alps/vectormath.h alps/vectortraits.h alps/copyright.h
HEADER_ALEA = alps/alea.h alps/alea/detailedbinning.h alps/alea/histogram.h alps/alea/nan.h alps/alea/nobinning.h alps/alea/observable.h alps/alea/observableset.h alps/alea/obsvalue.h alps/alea/simplebinning.h alps/alea/simpleobsdata.h alps/alea/simpleobservable.h alps/alea/simpleobseval.h
HEADER_FIXEDCAP = alps/fixed_capacity_deque.h alps/fixed_capacity_traits.h alps/fixed_capacity_fwd.h alps/fixed_capacity_vector.h alps/fixed_capacity/checking.h alps/fixed_capacity/deque_detail.h alps/fixed_capacity/uninitialized_array.h
HEADER_OSIRIS = alps/osiris.h alps/osiris/buffer.h alps/osiris/comm.h alps/osiris/dump.h alps/osiris/mpdump.h alps/osiris/os.h alps/osiris/process.h alps/osiris/xdrdump.h alps/osiris/std/impl.h alps/osiris/std/list.h alps/osiris/std/map.h alps/osiris/std/pair.h alps/osiris/std/string.h alps/osiris/std/valarray.h alps/osiris/std/vector.h alps/osiris/std/set.h
HEADER_LATTICE = alps/lattice.h alps/lattice/cell_traits.h alps/lattice/coordinate_traits.h alps/lattice/coordinatelattice.h alps/lattice/dimensional_traits.h alps/lattice/graph.h alps/lattice/graph_traits.h alps/lattice/graphproperties.h alps/lattice/hypercubic.h alps/lattice/lattice.h alps/lattice/latticedescriptor.h alps/lattice/latticegraph.h alps/lattice/latticegraphdescriptor.h alps/lattice/latticelibrary.h alps/lattice/parity.h alps/lattice/point_traits.h alps/lattice/propertymap.h alps/lattice/simplecell.h alps/lattice/simplelattice.h alps/lattice/unitcell.h alps/lattice/latticefactory.h
HEADER_MODEL = alps/model.h alps/model/basis.h alps/model/basisstates.h alps/model/modellibrary.h alps/model/operator.h alps/model/quantumnumber.h alps/model/sitebasis.h alps/model/sign.h alps/model/modelfactory.h alps/model/sitebasis.h alps/model/sitestate.h alps/model/sitebasisstates.h alps/model/sitebasisdescriptor.h
HEADER_PARSER = alps/xml.h alps/parser/attributes.h alps/parser/parser.h alps/parser/xmlhandler.h alps/parser/xmlparser.h alps/parser/xmlstream.h alps/parser/xslt.h
HEADER_RANDOM = alps/random.h alps/random/pseudo_des.h alps/random/random.h alps/random/rngfactory.h
HEADER_SCHEDULER = alps/scheduler.h alps/scheduler/info.h alps/scheduler/montecarlo.h alps/scheduler/options.h alps/scheduler/scheduler.h alps/scheduler/signal.hpp alps/scheduler/task.h alps/scheduler/types.h alps/scheduler/worker.h alps/scheduler/factory.h

HEADER = $(HEADER_BOOST) $(HEADER_ALPS) $(HEADER_ALEA) $(HEADER_FIXEDCAP) $(HEADER_LATTICE) $(HEADER_MODEL) $(HEADER_OSIRIS) $(HEADER_PARSER) $(HEADER_RANDOM) $(HEADER_SCHEDULER)

OBJ_BOOST_DATE_TIME = boost/greg_month.o boost/greg_weekday.o boost/gregorian_types.o boost/posix_time_types.o
OBJ_BOOST_FILESYSTEM = boost/exception.o boost/operations_posix_windows.o boost/path_posix_windows.o
OBJ_BOOST_REGEX = boost/c_regex_traits.o boost/c_regex_traits_common.o boost/cpp_regex_traits.o boost/cregex.o boost/fileiter.o boost/instances.o boost/posix_api.o boost/regex.o boost/regex_debug.o boost/regex_synch.o boost/w32_regex_traits.o boost/wide_posix_api.o boost/winstances.o
OBJ_BOOST_SIGNALS = boost/connection.o boost/signal_base.o boost/slot.o boost/trackable.o
OBJ_BOOST_THREAD = boost/condition.o boost/exceptions.o boost/mutex.o boost/once.o boost/recursive_mutex.o boost/thread.o boost/threadmon.o boost/tss.o boost/xtime.o
OBJ_BOOST = boost/throw_exception.o $(OBJ_BOOST_DATE_TIME) $(OBJ_BOOST_FILESYSTEM) $(OBJ_BOOST_REGEX) @OBJ_BOOST_SIGNALS@ @OBJ_BOOST_THREAD@

OBJ_ALPS = alps/evaluator.o alps/expression.o alps/parameterlist.o alps/parameters.o alps/copyright.o
OBJ_ALEA = alps/alea/nan.o alps/alea/observable.o alps/alea/observableset.o
OBJ_OSIRIS = alps/osiris/buffer.o alps/osiris/dump.o alps/osiris/os.o alps/osiris/xdrdump.o
OBJ_OSIRIS_SGL = alps/osiris/process.o alps/osiris/comm.o alps/osiris/mpdump.o
OBJ_OSIRIS_MPI = alps/osiris/process_mpi.o alps/osiris/comm_mpi.o alps/osiris/mpdump_mpi.o
OBJ_OSIRIS_PVM = alps/osiris/process_pvm.o alps/osiris/comm_pvm.o alps/osiris/mpdump_pvm.o
OBJ_LATTICE = alps/lattice/graph.o alps/lattice/latticedescriptor.o alps/lattice/latticegraphdescriptor.o alps/lattice/latticelibrary.o alps/lattice/unitcell.o
OBJ_MODEL = alps/model/modellibrary.o
OBJ_RANDOM = alps/random/rngfactory.o
OBJ_PARSER = alps/parser/parser.o alps/parser/xmlstream.o alps/parser/xmlhandler.o alps/parser/xmlparser.o alps/parser/xslt.o
OBJ_SCHEDULER = alps/scheduler/abstract_task.o alps/scheduler/remote_task.o alps/scheduler/remote_worker.o alps/scheduler/scheduler.o alps/scheduler/info.o alps/scheduler/single_scheduler.o alps/scheduler/master_scheduler.o alps/scheduler/slave_task.o alps/scheduler/montecarlo.o alps/scheduler/task.o alps/scheduler/mpp_scheduler.o alps/scheduler/worker.o alps/scheduler/signal.o alps/scheduler/options.o alps/scheduler/workertask.o alps/scheduler/factory.o
OBJ = @OBJ_BOOST@ $(OBJ_ALPS) $(OBJ_ALEA) $(OBJ_LATTICE) $(OBJ_MODEL) $(OBJ_OSIRIS) $(OBJ_PARSER) $(OBJ_RANDOM) $(OBJ_SCHEDULER)
OBJ_SGL = $(OBJ_OSIRIS_SGL)
OBJ_MPI = $(OBJ_OSIRIS_MPI)
OBJ_PVM = $(OBJ_OSIRIS_PVM)

LIB_MPI = libcomm-mpi.a
LIB_PVM = libcomm-pvm.a
LIB = libalps.a libcomm-sgl.a @LIB_MPI@ @LIB_PVM@

include $(top_srcdir)/config/rules.mk
include $(srcdir)/Makefile.dep

libalps.a : $(OBJ)
	$(ARXX) $(cxxflags) $(ldflags) -o $@ $(OBJ) $(libs)
libcomm-sgl.a : $(OBJ_SGL)
	$(ARXX) $(cxxflags) $(ldflags) -o $@ $(OBJ_SGL) $(libs)
libcomm-mpi.a : $(OBJ_MPI)
	$(ARXX) $(cxxflags) $(ldflags) -o $@ $(OBJ_MPI) $(libs)
libcomm-pvm.a : $(OBJ_PVM)
	$(ARXX) $(cxxflags) $(ldflags) -o $@ $(OBJ_PVM) $(libs)

distclean : distclean-files
distclean-files:
	rm -f boost/config.log boost/config.status alps/copyright.C alps/scheduler/scheduler.C

boost/%.o : $(srcdir)/boost/%.C
	$(CXX) -c $(cppflags) $(cxxflags) $< -o $@
boost/%.o : $(BOOST_SRCDIR)/date_time/src/gregorian/%.cpp
	$(CXX) -c $(cppflags) $(cxxflags) $< -o $@
boost/%.o : $(BOOST_SRCDIR)/date_time/src/posix_time/%.cpp
	$(CXX) -c $(cppflags) $(cxxflags) $< -o $@
boost/%.o : $(BOOST_SRCDIR)/filesystem/src/%.cpp
	$(CXX) -c $(cppflags) $(cxxflags) $< -o $@
boost/%.o: $(BOOST_SRCDIR)/regex/src/%.cpp
	$(CXX) -c $(cppflags) $(cxxflags) $< -o $@
boost/%.o: $(BOOST_SRCDIR)/signals/src/%.cpp
	$(CXX) -c $(cppflags) $(cxxflags) $< -o $@
boost/%.o : $(BOOST_SRCDIR)/thread/src/%.cpp
	$(CXX) -c $(cppflags) $(cxxflags) $< -o $@

alps/%.o : $(srcdir)/alps/%.C
	$(CXX) -c $(cppflags) $(cxxflags) $< -o $@
alps/%.o : $(builddir)/alps/%.C
	$(CXX) -c $(cppflags) $(cxxflags) $< -o $@
alps/alea/%.o : $(srcdir)/alps/alea/%.C
	$(CXX) -c $(cppflags) $(cxxflags) $< -o $@
alps/lattice/%.o : $(srcdir)/alps/lattice/%.C
	$(CXX) -c $(cppflags) $(cxxflags) $< -o $@
alps/model/%.o : $(srcdir)/alps/model/%.C
	$(CXX) -c $(cppflags) $(cxxflags) $< -o $@
alps/osiris/%.o : $(srcdir)/alps/osiris/%.C
	$(CXX) -c $(cppflags) $(cxxflags) $< -o $@
alps/osiris/%_mpi.o : $(srcdir)/alps/osiris/%.C
	$(CXX) -c $(cppflags_mpi) $(cxxflags) $< -o $@
alps/osiris/%_pvm.o : $(srcdir)/alps/osiris/%.C
	$(CXX) -c $(cppflags_pvm) $(cxxflags) $< -o $@
alps/parser/%.o : $(srcdir)/alps/parser/%.C
	$(CXX) -c $(cppflags) $(cxxflags) $< -o $@
alps/random/%.o : $(srcdir)/alps/random/%.C
	$(CXX) -c $(cppflags) $(cxxflags) $< -o $@
alps/scheduler/%.o : $(srcdir)/alps/scheduler/%.C
	$(CXX) -c $(cppflags) $(cxxflags) $< -o $@
alps/scheduler/%.o : $(builddir)/alps/scheduler/%.C
	$(CXX) -c $(cppflags) $(cxxflags) $< -o $@
