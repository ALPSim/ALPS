

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pyalps.tools &mdash; Pyalps v2.0.0rc4 documentation</title>
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.0.0rc4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Pyalps v2.0.0rc4 documentation" href="../../index.html" />
    <link rel="up" title="pyalps" href="../pyalps.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../modules.html">Pyalps v2.0.0rc4 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li>
          <li><a href="../pyalps.html" accesskey="U">pyalps</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pyalps.tools</h1><div class="highlight"><pre>
<span class="c"># ****************************************************************************</span>
<span class="c"># </span>
<span class="c"># ALPS Project: Algorithms and Libraries for Physics Simulations</span>
<span class="c"># </span>
<span class="c"># ALPS Libraries</span>
<span class="c"># </span>
<span class="c"># Copyright (C) 2010 by Bela Bauer &lt;bauerb@phys.ethz.ch&gt;</span>
<span class="c"># </span>
<span class="c"># This software is part of the ALPS libraries, published under the ALPS</span>
<span class="c"># Library License; you can use, redistribute it and/or modify it under</span>
<span class="c"># the terms of the license, either version 1 or (at your option) any later</span>
<span class="c"># version.</span>
<span class="c">#  </span>
<span class="c"># You should have received a copy of the ALPS Library License along with</span>
<span class="c"># the ALPS Libraries; see the file LICENSE.txt. If not, the license is also</span>
<span class="c"># available from http://alps.comp-phys.org/.</span>
<span class="c"># </span>
<span class="c"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR </span>
<span class="c"># IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, </span>
<span class="c"># FITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT </span>
<span class="c"># SHALL THE COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE </span>
<span class="c"># FOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN CONTRACT, TORT OR OTHERWISE, </span>
<span class="c"># ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER </span>
<span class="c"># DEALINGS IN THE SOFTWARE.</span>
<span class="c"># </span>
<span class="c"># ****************************************************************************</span>

<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">pyalps.pytools</span> <span class="kn">import</span> <span class="n">convert2xml</span><span class="p">,</span> <span class="n">hdf5_name_encode</span><span class="p">,</span> <span class="n">hdf5_name_decode</span><span class="p">,</span> <span class="n">rng</span>
<span class="kn">import</span> <span class="nn">pyalps.pytools</span> <span class="c"># the C++ conversion functions</span>
<span class="kn">from</span> <span class="nn">load</span> <span class="kn">import</span> <span class="n">loadBinningAnalysis</span><span class="p">,</span> <span class="n">loadMeasurements</span><span class="p">,</span><span class="n">loadEigenstateMeasurements</span><span class="p">,</span> <span class="n">loadSpectra</span><span class="p">,</span> <span class="n">loadIterationMeasurements</span><span class="p">,</span> <span class="n">loadObservableList</span><span class="p">,</span> <span class="n">loadProperties</span>
<span class="kn">from</span> <span class="nn">hlist</span> <span class="kn">import</span> <span class="n">deep_flatten</span><span class="p">,</span> <span class="n">flatten</span><span class="p">,</span> <span class="n">depth</span>
<span class="kn">from</span> <span class="nn">dict_intersect</span> <span class="kn">import</span> <span class="n">dict_intersect</span>
<span class="kn">from</span> <span class="nn">dataset</span> <span class="kn">import</span> <span class="n">DataSet</span>
<span class="kn">from</span> <span class="nn">plot_core</span> <span class="kn">import</span> <span class="n">read_xml</span> <span class="k">as</span> <span class="n">readAlpsXMLPlot</span>
<span class="kn">from</span> <span class="nn">dict_intersect</span> <span class="kn">import</span> <span class="o">*</span>

<div class="viewcode-block" id="make_list"><a class="viewcode-back" href="../../tools.html#pyalps.tools.make_list">[docs]</a><span class="k">def</span> <span class="nf">make_list</span><span class="p">(</span><span class="n">infiles</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">infiles</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">infiles</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">[</span><span class="n">infiles</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="size"><a class="viewcode-back" href="../../tools.html#pyalps.tools.size">[docs]</a><span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="k">return</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="list2cmdline"><a class="viewcode-back" href="../../tools.html#pyalps.tools.list2cmdline">[docs]</a><span class="k">def</span> <span class="nf">list2cmdline</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; convert a list of arguments to a valid commandline &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;Windows&#39;</span><span class="p">:</span>
      <span class="k">return</span> <span class="s">&#39;&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">list2cmdline</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">list2cmdline</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="executeCommand"><a class="viewcode-back" href="../../tools.html#pyalps.tools.executeCommand">[docs]</a><span class="k">def</span> <span class="nf">executeCommand</span><span class="p">(</span><span class="n">cmdline</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; execute the command given as list of arguments &quot;&quot;&quot;</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">list2cmdline</span><span class="p">(</span><span class="n">cmdline</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">cmd</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="executeCommandLogged"><a class="viewcode-back" href="../../tools.html#pyalps.tools.executeCommandLogged">[docs]</a><span class="k">def</span> <span class="nf">executeCommandLogged</span><span class="p">(</span><span class="n">cmdline</span><span class="p">,</span><span class="n">logfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; execute the command given as list of arguments and store the result into the log file &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;Windows&#39;</span><span class="p">:</span>
      <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;2&gt;&#39;</span><span class="p">,</span><span class="n">logfile</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;&gt;&#39;</span><span class="p">,</span><span class="n">logfile</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">executeCommand</span><span class="p">(</span><span class="n">cmdline</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="runApplication"><a class="viewcode-back" href="../../tools.html#pyalps.tools.runApplication">[docs]</a><span class="k">def</span> <span class="nf">runApplication</span><span class="p">(</span><span class="n">appname</span><span class="p">,</span> <span class="n">parmfile</span><span class="p">,</span> <span class="n">Tmin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">Tmax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">writexml</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">MPI</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mpirun</span><span class="o">=</span><span class="s">&#39;mpirun&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; run an ALPS application </span>
<span class="sd">    </span>
<span class="sd">        This function runs an ALPS application. The parameers are:</span>
<span class="sd">        </span>
<span class="sd">        appname: the name of the application</span>
<span class="sd">        parmfile: the name of the main XML input file</span>
<span class="sd">        write_xml: optional parameter, to be set to True if all results should be written to the XML files in addition to the HDF5 files</span>
<span class="sd">        Tmin: optional parameter specifying the minimum time between checks whether a MC simulatio is finished</span>
<span class="sd">        Tmax: optional parameter specifying the maximum time between checks whether a MC simulatio is finished</span>
<span class="sd">        MPI: optional parameter specifying the number of processes to be used in an MPI simulation. MPI is not used if this parameter is left at ots default value  None.</span>
<span class="sd">        mpirun: optional parameter giving the name of the executable used to laucnh MPI applications. The default is &#39;mpirun&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cmdline</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">MPI</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="n">mpirun</span><span class="p">,</span><span class="s">&#39;-np&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">MPI</span><span class="p">)]</span>
    <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="n">appname</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">MPI</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--mpi&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">appname</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;sparsediag&#39;</span><span class="p">,</span><span class="s">&#39;fulldiag&#39;</span><span class="p">,</span><span class="s">&#39;dmrg&#39;</span><span class="p">]:</span>
            <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--Nmax&#39;</span><span class="p">,</span><span class="s">&#39;1&#39;</span><span class="p">]</span>
    <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="n">parmfile</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">Tmin</span><span class="p">:</span>
      <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--Tmin&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">Tmin</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">Tmax</span><span class="p">:</span>
      <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--TMax&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">TMax</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">writexml</span><span class="p">:</span>
      <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--write-xml&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">executeCommand</span><span class="p">(</span><span class="n">cmdline</span><span class="p">),</span><span class="n">parmfile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.in.xml&#39;</span><span class="p">,</span><span class="s">&#39;.out.xml&#39;</span><span class="p">))</span>
    </div>
<div class="viewcode-block" id="runDMFT"><a class="viewcode-back" href="../../tools.html#pyalps.tools.runDMFT">[docs]</a><span class="k">def</span> <span class="nf">runDMFT</span><span class="p">(</span><span class="n">infiles</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; run the ALPS DMFT application </span>
<span class="sd">    </span>
<span class="sd">        The ALPS DMFT application does not (yet) use the standard ALPS input files and scheduler. Thus there is a separate function to call it. </span>
<span class="sd">        This function takes only one parameter, the lost of input files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">appname</span><span class="o">=</span><span class="s">&#39;dmft&#39;</span>
    <span class="n">cmdline</span> <span class="o">=</span> <span class="p">[</span><span class="n">appname</span><span class="p">]</span>
    <span class="n">cmdline</span> <span class="o">+=</span> <span class="n">make_list</span><span class="p">(</span><span class="n">infiles</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">executeCommand</span><span class="p">(</span><span class="n">cmdline</span><span class="p">))</span>
    </div>
<div class="viewcode-block" id="evaluateLoop"><a class="viewcode-back" href="../../tools.html#pyalps.tools.evaluateLoop">[docs]</a><span class="k">def</span> <span class="nf">evaluateLoop</span><span class="p">(</span><span class="n">infiles</span><span class="p">,</span> <span class="n">appname</span><span class="o">=</span><span class="s">&#39;loop&#39;</span><span class="p">,</span> <span class="n">write_xml</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; evaluate results of the looper QMC application </span>
<span class="sd">    </span>
<span class="sd">        this function calls the evaluate tool of the looper application. Additionally evaluated results are written back into the files. Besides a list of result files it takes one optional argument:</span>
<span class="sd">        </span>
<span class="sd">        write_xml: if this optional argument is set to True, the results will also bw written to the XML files</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cmdline</span> <span class="o">=</span> <span class="p">[</span><span class="n">appname</span><span class="p">,</span><span class="s">&#39;--evaluate&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">write_xml</span><span class="p">:</span>
      <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--write_xml&#39;</span><span class="p">]</span>
    <span class="n">cmdline</span> <span class="o">+=</span> <span class="n">make_list</span><span class="p">(</span><span class="n">infiles</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">executeCommand</span><span class="p">(</span><span class="n">cmdline</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="evaluateSpinMC"><a class="viewcode-back" href="../../tools.html#pyalps.tools.evaluateSpinMC">[docs]</a><span class="k">def</span> <span class="nf">evaluateSpinMC</span><span class="p">(</span><span class="n">infiles</span><span class="p">,</span> <span class="n">appname</span><span class="o">=</span><span class="s">&#39;spinmc_evaluate&#39;</span><span class="p">,</span> <span class="n">write_xml</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; evaluate results of the spinmc application </span>
<span class="sd">    </span>
<span class="sd">        this function calls the evaluate tool of the spinmc application. Additionally evaluated results are written back into the files. Besides a list of result files it takes one optional argument:</span>
<span class="sd">        </span>
<span class="sd">        write_xml: if this optional argument is set to True, the results will also bw written to the XML files</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cmdline</span> <span class="o">=</span> <span class="p">[</span><span class="n">appname</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">write_xml</span><span class="p">:</span>
      <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--write_xml&#39;</span><span class="p">]</span>
    <span class="n">cmdline</span> <span class="o">+=</span> <span class="n">make_list</span><span class="p">(</span><span class="n">infiles</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">executeCommand</span><span class="p">(</span><span class="n">cmdline</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="evaluateQWL"><a class="viewcode-back" href="../../tools.html#pyalps.tools.evaluateQWL">[docs]</a><span class="k">def</span> <span class="nf">evaluateQWL</span><span class="p">(</span><span class="n">infiles</span><span class="p">,</span> <span class="n">appname</span><span class="o">=</span><span class="s">&#39;qwl_evaluate&#39;</span><span class="p">,</span> <span class="n">DELTA_T</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">T_MIN</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">T_MAX</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; evaluate results of the quantum Wang-Landau application </span>
<span class="sd">    </span>
<span class="sd">        this function calls the evaluate tool of the quantum Wang-Landau application. Besides a list of result files it takes the following arguments:</span>
<span class="sd">        T_MIN: the lower end of the temperature range for which quantities are evaluated</span>
<span class="sd">        T_MAX: the upper end of the temperature range for which quantities are evaluated</span>
<span class="sd">        DELTA_T: the temperature steps to be used between T_MIN and T_MAX</span>
<span class="sd">        </span>
<span class="sd">        This function returns a list of lists of DataSet objects, for the various properties evaluated for each of the input files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cmdline</span> <span class="o">=</span> <span class="p">[</span><span class="n">appname</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">DELTA_T</span><span class="p">:</span>
      <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--DELTA_T&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">DELTA_T</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">T_MIN</span><span class="p">:</span>
      <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--T_MIN&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">T_MIN</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">T_MAX</span><span class="p">:</span>
      <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--T_MAX&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">T_MAX</span><span class="p">)]</span>
    <span class="n">cmdline</span> <span class="o">+=</span> <span class="n">make_list</span><span class="p">(</span><span class="n">infiles</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">executeCommand</span><span class="p">(</span><span class="n">cmdline</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">Excpetion</span><span class="p">(</span><span class="s">&quot;Execution error in evaluateQWL: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">infiles</span><span class="p">:</span>
      <span class="n">datasets</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
      <span class="n">ofname</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.out.xml&#39;</span><span class="p">,</span> <span class="s">&#39;.plot.*.xml&#39;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">ofname</span><span class="p">):</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">readAlpsXMLPlot</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">datasets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s">&#39;ylabel&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">datasets</span>
</div>
<div class="viewcode-block" id="evaluateFulldiagVersusT"><a class="viewcode-back" href="../../tools.html#pyalps.tools.evaluateFulldiagVersusT">[docs]</a><span class="k">def</span> <span class="nf">evaluateFulldiagVersusT</span><span class="p">(</span><span class="n">infiles</span><span class="p">,</span> <span class="n">appname</span><span class="o">=</span><span class="s">&#39;fulldiag_evaluate&#39;</span><span class="p">,</span> <span class="n">DELTA_T</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">T_MIN</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">T_MAX</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; evaluate results of the fulldiag application as a function of temperature</span>
<span class="sd">    </span>
<span class="sd">        this function calls the evaluate tool of the fulldiag application and evaluates several quantities as a function of temperature. Besides a list of result files it takes the following arguments:</span>
<span class="sd">        T_MIN: the lower end of the temperature range for which quantities are evaluated</span>
<span class="sd">        T_MAX: the upper end of the temperature range for which quantities are evaluated</span>
<span class="sd">        DELTA_T: the temperature steps to be used between T_MIN and T_MAX</span>
<span class="sd">        H: (optional) the magnetic field at which all data should be evaluated</span>
<span class="sd">        </span>
<span class="sd">        This function returns a list of lists of DataSet objects, for the various properties evaluated for each of the input files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cmdline</span> <span class="o">=</span> <span class="p">[</span><span class="n">appname</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">DELTA_T</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--DELTA_T&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">DELTA_T</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">T_MIN</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--T_MIN&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">T_MIN</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">T_MAX</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--T_MAX&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">T_MAX</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">H</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--H&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">H</span><span class="p">)]</span>
    <span class="n">cmdline</span> <span class="o">+=</span> <span class="n">make_list</span><span class="p">(</span><span class="n">infiles</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">executeCommand</span><span class="p">(</span><span class="n">cmdline</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Execution error in evaluateFulldiagVersusT: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">infiles</span><span class="p">:</span>
      <span class="n">datasets</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
      <span class="n">ofname</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.out.xml&#39;</span><span class="p">,</span> <span class="s">&#39;.plot.*.xml&#39;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">ofname</span><span class="p">):</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">readAlpsXMLPlot</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">datasets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s">&#39;ylabel&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">datasets</span>
</div>
<div class="viewcode-block" id="evaluateFulldiagVersusH"><a class="viewcode-back" href="../../tools.html#pyalps.tools.evaluateFulldiagVersusH">[docs]</a><span class="k">def</span> <span class="nf">evaluateFulldiagVersusH</span><span class="p">(</span><span class="n">infiles</span><span class="p">,</span> <span class="n">appname</span><span class="o">=</span><span class="s">&#39;fulldiag_evaluate&#39;</span><span class="p">,</span> <span class="n">DELTA_H</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">H_MIN</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">H_MAX</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; evaluate results of the fulldiag application as a function of magnetic field h</span>
<span class="sd">    </span>
<span class="sd">        this function calls the evaluate tool of the fulldiag application and evaluates several quantities as a function of magnetic field. Besides a list of result files it takes the following arguments:</span>
<span class="sd">        H_MIN: the lower end of the field range for which quantities are evaluated</span>
<span class="sd">        H_MAX: the upper end of the temperature range for which quantities are evaluated</span>
<span class="sd">        DELTA_H: the field steps to be used between H_MIN and H_MAX</span>
<span class="sd">        T: the temperature field at which all data should be evaluated</span>
<span class="sd">        </span>
<span class="sd">        This function returns a list of lists of DataSet objects, for the various properties evaluated for each of the input files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cmdline</span> <span class="o">=</span> <span class="p">[</span><span class="n">appname</span><span class="p">,</span><span class="s">&#39;--versus&#39;</span><span class="p">,</span> <span class="s">&#39;h&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">DELTA_H</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--DELTA_H&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">DELTA_H</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">H_MIN</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--H_MIN&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">H_MIN</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">H_MAX</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--H_MAX&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">H_MAX</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">T</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--T&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">T</span><span class="p">)]</span>
    <span class="n">cmdline</span> <span class="o">+=</span> <span class="n">make_list</span><span class="p">(</span><span class="n">infiles</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">executeCommand</span><span class="p">(</span><span class="n">cmdline</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Execution error in evaluateFulldiagVersusH: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">infiles</span><span class="p">:</span>
      <span class="n">datasets</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
      <span class="n">ofname</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.out.xml&#39;</span><span class="p">,</span> <span class="s">&#39;.plot.*.xml&#39;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">ofname</span><span class="p">):</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">readAlpsXMLPlot</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">datasets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s">&#39;ylabel&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">datasets</span>

       </div>
<div class="viewcode-block" id="inVistrails"><a class="viewcode-back" href="../../tools.html#pyalps.tools.inVistrails">[docs]</a><span class="k">def</span> <span class="nf">inVistrails</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; returns True if called from within VisTrails &quot;&quot;&quot;</span>
    <span class="n">in_vistrails</span><span class="o">=</span><span class="bp">True</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="kn">import</span> <span class="nn">core.modules.basic_modules</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="n">in_vistrails</span><span class="o">=</span><span class="bp">False</span>
    <span class="k">return</span> <span class="n">in_vistrails</span>
    </div>
<div class="viewcode-block" id="xslPath"><a class="viewcode-back" href="../../tools.html#pyalps.tools.xslPath">[docs]</a><span class="k">def</span> <span class="nf">xslPath</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; return the path to the ALPS.xsl stylesheet &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">inVistrails</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span><span class="o">==</span><span class="s">&#39;Darwin&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exec_prefix</span><span class="p">,</span><span class="s">&#39;../Resources/lib/xml/ALPS.xsl&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span><span class="o">==</span><span class="s">&#39;Windows&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exec_prefix</span><span class="p">,</span><span class="s">&#39;..&#39;</span><span class="p">,</span><span class="s">&#39;lib&#39;</span><span class="p">,</span><span class="s">&#39;xml&#39;</span><span class="p">,</span><span class="s">&#39;ALPS.xsl&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pyalps</span><span class="o">.</span><span class="n">pytools</span><span class="o">.</span><span class="n">search_xml_library_path</span><span class="p">(</span><span class="s">&quot;ALPS.xsl&quot;</span><span class="p">)</span>
    
    </div>
<div class="viewcode-block" id="copyStylesheet"><a class="viewcode-back" href="../../tools.html#pyalps.tools.copyStylesheet">[docs]</a><span class="k">def</span> <span class="nf">copyStylesheet</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; copy the ALPS.xsl stylesheet to the specified directory &quot;&quot;&quot;</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s">&#39;ALPS.xsl&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
      <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">xslPath</span><span class="p">(),</span> <span class="n">target</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="writeTaskXMLFile"><a class="viewcode-back" href="../../tools.html#pyalps.tools.writeTaskXMLFile">[docs]</a><span class="k">def</span> <span class="nf">writeTaskXMLFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">parms</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;ALPS.xsl&quot;?&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;SIMULATION xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;http://xml.comp-phys.org/2003/8/QMCXML.xsd&quot;&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;  &lt;PARAMETERS&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;PARAMETER name=&quot;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;&quot;&gt;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="n">key</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;&lt;/PARAMETER&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;  &lt;/PARAMETERS&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;/SIMULATION&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span>  <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.in.xml&#39;</span><span class="p">,</span><span class="s">&#39;.out.*&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.in.xml&#39;</span><span class="p">,</span><span class="s">&#39;.clone*&#39;</span><span class="p">)):</span>
      <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="generateSeed"><a class="viewcode-back" href="../../tools.html#pyalps.tools.generateSeed">[docs]</a><span class="k">def</span> <span class="nf">generateSeed</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; generate a random seed based on the current time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">baseseed</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">microsecond</span><span class="o">+</span><span class="mi">1000000</span><span class="o">*</span><span class="n">now</span><span class="o">.</span><span class="n">second</span><span class="o">+</span><span class="mi">60000000</span><span class="o">*</span><span class="n">now</span><span class="o">.</span><span class="n">minute</span>
    <span class="n">baseseed</span> <span class="o">=</span> <span class="p">((</span><span class="n">baseseed</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">baseseed</span> <span class="o">&gt;&gt;</span> <span class="mi">22</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">baseseed</span>
</div>
<div class="viewcode-block" id="writeInputFiles"><a class="viewcode-back" href="../../tools.html#pyalps.tools.writeInputFiles">[docs]</a><span class="k">def</span> <span class="nf">writeInputFiles</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">parms</span><span class="p">,</span> <span class="n">baseseed</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This function writes the XML input files for ALPS</span>
<span class="sd">    </span>
<span class="sd">         Parameters are:</span>
<span class="sd">         fname: the base file name of the XML files that will be written</span>
<span class="sd">         parms: a list of dicts containing the simulation parameters</span>
<span class="sd">         baseseed: optional parameter giving a random number seed from which seeds for the individual simulations will be calculated. The default value is taken from the current time.</span>
<span class="sd">    </span>
<span class="sd">         The function returns the name of the main XML input file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">base_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="n">fname</span><span class="o">+</span><span class="s">&#39;.in.xml&#39;</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;ALPS.xsl&quot;?&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;JOB xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;http://xml.comp-phys.org/2003/8/job.xsd&quot;&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;  &lt;OUTPUT file=&quot;&#39;</span><span class="o">+</span><span class="n">base_name</span><span class="o">+</span><span class="s">&#39;.out.xml&quot;/&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
   
    <span class="n">bits</span> <span class="o">=</span> <span class="mi">31</span><span class="p">;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parms</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">n</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
      <span class="n">n</span> <span class="o">/=</span> <span class="mi">2</span>
      <span class="n">bits</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">baseseed</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">baseseed</span> <span class="o">=</span> <span class="n">generateSeed</span><span class="p">()</span>
     
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
      <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;SEED&#39;</span><span class="p">):</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="n">baseseed</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">32</span><span class="o">/</span><span class="n">bits</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
          <span class="n">seed</span> <span class="o">^=</span> <span class="p">((</span><span class="n">count</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">bits</span><span class="p">))</span>
          <span class="n">seed</span> <span class="o">&amp;=</span> <span class="p">((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">30</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">30</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
          <span class="n">p</span><span class="p">[</span><span class="s">&#39;SEED&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seed</span>
      <span class="n">taskname</span> <span class="o">=</span> <span class="n">base_name</span><span class="o">+</span><span class="s">&#39;.task&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;  &lt;TASK status=&quot;new&quot;&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;    &lt;INPUT file=&quot;&#39;</span><span class="o">+</span><span class="n">taskname</span><span class="o">+</span><span class="s">&#39;.in.xml&quot;/&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;    &lt;OUTPUT file=&quot;&#39;</span><span class="o">+</span><span class="n">taskname</span><span class="o">+</span><span class="s">&#39;.out.xml&quot;/&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;  &lt;/TASK&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
      <span class="n">writeTaskXMLFile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span><span class="n">taskname</span><span class="o">+</span><span class="s">&#39;.in.xml&#39;</span><span class="p">),</span><span class="n">p</span><span class="p">)</span>

    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;/JOB&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">dirname</span><span class="o">==</span><span class="s">&#39;&#39;</span><span class="p">):</span>
      <span class="n">copyStylesheet</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">copyStylesheet</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fname</span><span class="o">+</span><span class="s">&#39;.in.xml&#39;</span>
        
</div>
<div class="viewcode-block" id="writeParameterFile"><a class="viewcode-back" href="../../tools.html#pyalps.tools.writeParameterFile">[docs]</a><span class="k">def</span> <span class="nf">writeParameterFile</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">parms</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This function writes a text input file for simple ALPS applications like DMFT</span>
<span class="sd">    </span>
<span class="sd">        The arguments are:</span>
<span class="sd">        </span>
<span class="sd">          filename: the name of the parameter file to be written</span>
<span class="sd">          parms: the parameter dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
      <span class="n">value</span> <span class="o">=</span> <span class="n">parms</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
      <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; = &quot;&#39;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="s">&#39;&quot;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fname</span>

</div>
<div class="viewcode-block" id="recursiveGlob"><a class="viewcode-back" href="../../tools.html#pyalps.tools.recursiveGlob">[docs]</a><span class="k">def</span> <span class="nf">recursiveGlob</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span><span class="n">pattern</span><span class="p">):</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">pattern</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="n">recursiveGlob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">pattern</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span>
    </div>
<div class="viewcode-block" id="getResultFiles"><a class="viewcode-back" href="../../tools.html#pyalps.tools.getResultFiles">[docs]</a><span class="k">def</span> <span class="nf">getResultFiles</span><span class="p">(</span><span class="n">dirname</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="n">pattern</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get all result files matching the given pattern or prefix </span>
<span class="sd">    </span>
<span class="sd">        This function returns a list of all ALPS result files matching a given pattern, starting recursively from a given directory.</span>
<span class="sd">        The pattern can be either specificed by giving a prefix for the files, which is then augmented with the default ALPS file name suffixes. </span>
<span class="sd">        ALternatively a fiull custom regular expression pattern can be specified.</span>
<span class="sd">        </span>
<span class="sd">        The paramters are:</span>
<span class="sd">        </span>
<span class="sd">        dirname: The directory from which to start the recursive search, defaulting to the current working directory.</span>
<span class="sd">        pattern: a regular expression pattern resricting the files to be matches</span>
<span class="sd">        prefix: a pattern which the start of the file names has to match. This will be augmented by the standard ALPS file name endings &#39;*.task*.out.xml&#39; or &#39;*.h5&#39; to form the full pattern.</span>
<span class="sd">        </span>
<span class="sd">        The function returns a list of filenames</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">prefix</span><span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">pattern</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Cannot define both prefix and pattern&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span>
    <span class="k">if</span> <span class="n">pattern</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">pattern</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">+</span><span class="s">&#39;.task*.out.xml&#39;</span>
      <span class="n">res</span><span class="o">=</span><span class="n">recursiveGlob</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">+</span><span class="s">&#39;*.h5&#39;</span>
        <span class="n">res</span><span class="o">=</span><span class="n">recursiveGlob</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">res</span> <span class="o">=</span> <span class="n">recursiveGlob</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>
</div>
<span class="k">def</span> <span class="nf">groupSets</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">for_each</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="sd">&quot;&quot;&quot; groups a list of DataSet objects into a list of lists</span>
<span class="sd">        </span>
<span class="sd">        this function groups a list of DataSet objects into a list of lists, according to the values of the properties given in the for_ech argument. DataSet objects with the same values of the properties given in for_each are grouped together.</span>
<span class="sd">        The parameters are:</span>
<span class="sd">          data: the data to be grouped</span>
<span class="sd">          for_each: the properties according to which the data is grouped</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="n">depth</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dd</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">hgroups</span> <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">hgroups_idcs</span> <span class="o">=</span> <span class="n">hgroups</span><span class="o">.</span><span class="n">indices</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hgroups</span> <span class="o">=</span> <span class="p">[</span><span class="n">groups</span><span class="p">]</span>
        <span class="n">hgroups_idcs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">hgroups_idcs</span><span class="p">:</span>
        <span class="n">sets</span> <span class="o">=</span> <span class="n">hgroups</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    
        <span class="n">for_each_sets</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">iset</span> <span class="ow">in</span> <span class="n">sets</span><span class="p">:</span>
            <span class="n">fe_par_set</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">iset</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">for_each</span><span class="p">))</span>
        
            <span class="k">if</span> <span class="n">fe_par_set</span> <span class="ow">in</span> <span class="n">for_each_sets</span><span class="p">:</span>
                <span class="n">for_each_sets</span><span class="p">[</span><span class="n">fe_par_set</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iset</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">for_each_sets</span><span class="p">[</span><span class="n">fe_par_set</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">iset</span><span class="p">]</span>
    
        <span class="n">hgroups</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">for_each_sets</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">dd</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">groups</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">hgroups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<div class="viewcode-block" id="collectXY"><a class="viewcode-back" href="../../tools.html#pyalps.tools.collectXY">[docs]</a><span class="k">def</span> <span class="nf">collectXY</span><span class="p">(</span><span class="n">sets</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">foreach</span><span class="o">=</span><span class="p">[]):</span>
      <span class="sd">&quot;&quot;&quot; collects specified data from a list of DataSet objects</span>
<span class="sd">         </span>
<span class="sd">          this function is used to collect data from a list of DataSet objects, to prepare plots or evaluation. The parameters are:</span>
<span class="sd">    </span>
<span class="sd">            sets:    the list of datasets</span>
<span class="sd">            x:       the name of the property or measurement to be used as x-value of the collected results </span>
<span class="sd">            y:       the name of the property or measurement to be used as y-value of the collected results </span>
<span class="sd">            foreach: an optional list of properties used for grouping the results. A separate DataSet object is created for each unique set of values of the specified parameers.</span>
<span class="sd">            </span>
<span class="sd">          The function returns a list of DataSet objects.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="n">foreach_sets</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="k">for</span> <span class="n">iset</span> <span class="ow">in</span> <span class="n">flatten</span><span class="p">(</span><span class="n">sets</span><span class="p">):</span>
          <span class="k">if</span> <span class="n">iset</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s">&#39;observable&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">y</span><span class="p">:</span>
              <span class="k">continue</span>
          
          <span class="n">fe_par_set</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">iset</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">foreach</span><span class="p">))</span>
          
          <span class="k">if</span> <span class="n">fe_par_set</span> <span class="ow">in</span> <span class="n">foreach_sets</span><span class="p">:</span>
              <span class="n">foreach_sets</span><span class="p">[</span><span class="n">fe_par_set</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iset</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="n">foreach_sets</span><span class="p">[</span><span class="n">fe_par_set</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">iset</span><span class="p">]</span>
      
      <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">foreach_sets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
          <span class="n">common_props</span> <span class="o">=</span> <span class="n">dict_intersect</span><span class="p">([</span><span class="n">q</span><span class="o">.</span><span class="n">props</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">v</span><span class="p">])</span>
          <span class="n">res</span> <span class="o">=</span> <span class="n">DataSet</span><span class="p">()</span>
          <span class="n">res</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="n">common_props</span>
          <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">foreach</span><span class="p">)):</span>
              <span class="n">m</span> <span class="o">=</span> <span class="n">foreach</span><span class="p">[</span><span class="n">im</span><span class="p">]</span>
              <span class="n">res</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="n">im</span><span class="p">]</span>
          <span class="n">res</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s">&#39;xlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
          <span class="n">res</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s">&#39;ylabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
          
          <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
              <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                  <span class="n">res</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s">&#39;line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span>
              <span class="n">xvalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">))])</span>
              <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                  <span class="n">res</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xvalue</span> <span class="p">))</span>
                  <span class="n">res</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">res</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
              <span class="k">else</span><span class="p">:</span>
                  <span class="n">res</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">xvalue</span>
                  <span class="n">res</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">y</span>
          
          <span class="n">order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="c">#, kind = &#39;mergesort&#39;)</span>
          <span class="n">res</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">order</span><span class="p">]</span>
          <span class="n">res</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">order</span><span class="p">]</span>
          <span class="n">res</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
          <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">foreach</span><span class="p">)):</span>
              <span class="n">res</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">foreach</span><span class="p">[</span><span class="n">im</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="n">im</span><span class="p">])</span>
          
          <span class="n">foreach_sets</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span>
      <span class="k">return</span> <span class="n">foreach_sets</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="groupSets"><a class="viewcode-back" href="../../tools.html#pyalps.tools.groupSets">[docs]</a><span class="k">def</span> <span class="nf">groupSets</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">for_each</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="sd">&quot;&quot;&quot; groups a list of DataSet objects into a list of lists</span>
<span class="sd">        </span>
<span class="sd">        this function groups a list of DataSet objects into a list of lists, according to the values of the properties given in the for_ech argument. DataSet objects with the same values of the properties given in for_each are grouped together.</span>
<span class="sd">        The parameters are:</span>
<span class="sd">          data: the data to be grouped</span>
<span class="sd">          for_each: the properties according to which the data is grouped</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="n">depth</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dd</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">hgroups</span> <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">hgroups_idcs</span> <span class="o">=</span> <span class="n">hgroups</span><span class="o">.</span><span class="n">indices</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hgroups</span> <span class="o">=</span> <span class="p">[</span><span class="n">groups</span><span class="p">]</span>
        <span class="n">hgroups_idcs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">hgroups_idcs</span><span class="p">:</span>
        <span class="n">sets</span> <span class="o">=</span> <span class="n">hgroups</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

        <span class="n">for_each_sets</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">iset</span> <span class="ow">in</span> <span class="n">sets</span><span class="p">:</span>
            <span class="n">fe_par_set</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">iset</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">for_each</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">fe_par_set</span> <span class="ow">in</span> <span class="n">for_each_sets</span><span class="p">:</span>
                <span class="n">for_each_sets</span><span class="p">[</span><span class="n">fe_par_set</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iset</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">for_each_sets</span><span class="p">[</span><span class="n">fe_par_set</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">iset</span><span class="p">]</span>

        <span class="n">hgroups</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">for_each_sets</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">dd</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">groups</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">hgroups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="subtract_spectrum"><a class="viewcode-back" href="../../tools.html#pyalps.tools.subtract_spectrum">[docs]</a><span class="k">def</span> <span class="nf">subtract_spectrum</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">,</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; subtract one spectrum from another </span>
<span class="sd">    </span>
<span class="sd">        this function takes two DataSet objects as input and returns a new DataSet that contains all (x,y) values that occur in the first but not in the second.</span>
<span class="sd">        The intended use is for plotting of spectra, where states that occur in several quantum number sectors should sometimes be shown only once.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">pyalps</span><span class="o">.</span><span class="n">DataSet</span><span class="p">()</span>
    <span class="n">res</span><span class="o">.</span><span class="n">props</span> <span class="o">=</span> <span class="n">s1</span><span class="o">.</span><span class="n">props</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">x</span><span class="p">)):</span>
        <span class="n">remove</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s2</span><span class="o">.</span><span class="n">x</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">s2</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">tolerance</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">s2</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">tolerance</span><span class="p">:</span>
                <span class="n">remove</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">remove</span><span class="p">:</span>
            <span class="n">res</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">s1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">res</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">s1</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">res</span>
</div>
<div class="viewcode-block" id="save_parameters"><a class="viewcode-back" href="../../tools.html#pyalps.tools.save_parameters">[docs]</a><span class="k">def</span> <span class="nf">save_parameters</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">parms</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; saves parameters from a dict into an HDF5 file</span>
<span class="sd">    </span>
<span class="sd">        this function saves parameters from a Python dict into an ALPS HDF5 file.</span>
<span class="sd">        </span>
<span class="sd">        The arguments are:</span>
<span class="sd">        </span>
<span class="sd">          filename: the name of the HDF5 file</span>
<span class="sd">          parms: the parameter dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f1</span><span class="o">=</span><span class="n">h5</span><span class="o">.</span><span class="n">oArchive</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parms</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">f1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;/parameters/&#39;</span><span class="o">+</span><span class="n">key</span><span class="p">,</span><span class="n">parms</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="runTEBD"><a class="viewcode-back" href="../../tools.html#pyalps.tools.runTEBD">[docs]</a><span class="k">def</span> <span class="nf">runTEBD</span><span class="p">(</span><span class="n">infileList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; run a TEBD application &quot;&quot;&quot;</span>
    <span class="n">resList</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">appname</span><span class="o">=</span><span class="s">&#39;tebd&#39;</span>
    <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">infileList</span><span class="p">:</span>
        <span class="n">cmdline</span> <span class="o">=</span> <span class="p">[</span><span class="n">appname</span><span class="p">]</span>
        <span class="n">cmdline</span> <span class="o">+=</span> <span class="p">[</span><span class="n">infile</span><span class="p">]</span>
        <span class="n">resList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">executeCommand</span><span class="p">(</span><span class="n">cmdline</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">resList</span>
</div>
<div class="viewcode-block" id="stringListToList"><a class="viewcode-back" href="../../tools.html#pyalps.tools.stringListToList">[docs]</a><span class="k">def</span> <span class="nf">stringListToList</span><span class="p">(</span><span class="n">inList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert a string which is of the form [...] with ... a collection of lists of floats and floats separated by commas</span>
<span class="sd">    into the list [...].&quot;&quot;&quot;</span>
    <span class="n">outList</span><span class="o">=</span><span class="p">[]</span>
    <span class="c">#sort out strings vs. floats</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">inList</span><span class="p">)</span><span class="o">==</span><span class="nb">str</span><span class="p">:</span>
        <span class="c">#remove whitespace and initial/final []</span>
        <span class="n">dum</span><span class="o">=</span><span class="n">inList</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">inList</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="c">#find number of bracketed items (they come in pairs)</span>
        <span class="n">numbrackets</span><span class="o">=</span><span class="n">dum</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">numbrackets</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span>
            <span class="n">unbracketed</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">dum</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">unbracketed</span><span class="p">:</span>
                <span class="n">outList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">q</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">numbrackets</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numbrackets</span><span class="p">):</span>
                <span class="c">#find the first bracketed pair starting at count</span>
                <span class="n">startInd</span><span class="o">=</span><span class="n">dum</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="n">count</span><span class="p">)</span>
                <span class="n">finishInd</span><span class="o">=</span><span class="n">dum</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">startInd</span><span class="o">&gt;</span><span class="n">count</span><span class="p">:</span>
                    <span class="n">unbracketed</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,(</span><span class="n">dum</span><span class="p">[</span><span class="n">count</span><span class="p">:</span><span class="n">startInd</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>\
                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)))</span>
                    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">unbracketed</span><span class="p">:</span>
                        <span class="n">outList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">q</span><span class="p">])</span>
                <span class="n">outList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">dum</span><span class="p">[</span><span class="n">startInd</span><span class="p">:</span><span class="n">finishInd</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span>\
                <span class="n">replace</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)))</span>
                <span class="n">count</span><span class="o">=</span><span class="n">finishInd</span><span class="o">+</span><span class="mi">2</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dum</span><span class="p">)</span><span class="o">-</span><span class="n">count</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">unbracketed</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">dum</span><span class="p">[</span><span class="n">count</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">dum</span><span class="p">)]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>\
                <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">unbracketed</span><span class="p">:</span>
                    <span class="n">outList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">q</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">outList</span><span class="o">=</span><span class="n">inList</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outList</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">outList</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">!=</span><span class="nb">list</span><span class="p">:</span>
                <span class="n">outList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">outList</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">outList</span>
</div>
<div class="viewcode-block" id="stringListToListstring"><a class="viewcode-back" href="../../tools.html#pyalps.tools.stringListToListstring">[docs]</a><span class="k">def</span> <span class="nf">stringListToListstring</span><span class="p">(</span><span class="n">inList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert a string which is of the form [...] with ... a collection of lists of strings and strings separated by commas</span>
<span class="sd">    into the list [...].&quot;&quot;&quot;</span>

    <span class="n">outList</span><span class="o">=</span><span class="p">[]</span>
    <span class="c">#sort out strings vs. floats</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">inList</span><span class="p">)</span><span class="o">==</span><span class="nb">str</span><span class="p">:</span>
        <span class="c">#remove whitespace and initial/final []</span>
        <span class="n">dum</span><span class="o">=</span><span class="n">inList</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">inList</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="c">#find number of bracketed items (they come in pairs)</span>
        <span class="n">numbrackets</span><span class="o">=</span><span class="n">dum</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">numbrackets</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span>
            <span class="n">unbracketed</span><span class="o">=</span><span class="n">dum</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">unbracketed</span><span class="p">:</span>
                <span class="n">outList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">q</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)])</span>
        <span class="k">elif</span> <span class="n">numbrackets</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numbrackets</span><span class="p">):</span>
                <span class="c">#find the first bracketed pair starting at count</span>
                <span class="n">startInd</span><span class="o">=</span><span class="n">dum</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="n">count</span><span class="p">)</span>
                <span class="n">finishInd</span><span class="o">=</span><span class="n">dum</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">startInd</span><span class="o">&gt;</span><span class="n">count</span><span class="p">:</span>
                    <span class="n">unbracketed</span><span class="o">=</span><span class="p">(</span><span class="n">dum</span><span class="p">[</span><span class="n">count</span><span class="p">:</span><span class="n">startInd</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>\
                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">unbracketed</span><span class="p">:</span>
                        <span class="n">outList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">q</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)])</span>
                <span class="n">outList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dum</span><span class="p">[</span><span class="n">startInd</span><span class="p">:</span><span class="n">finishInd</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span>\
                <span class="n">replace</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">))</span>
                <span class="n">count</span><span class="o">=</span><span class="n">finishInd</span><span class="o">+</span><span class="mi">2</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dum</span><span class="p">)</span><span class="o">-</span><span class="n">count</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">unbracketed</span><span class="o">=</span><span class="n">dum</span><span class="p">[</span><span class="n">count</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">dum</span><span class="p">)]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>\
                <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">unbracketed</span><span class="p">:</span>
                    <span class="n">outList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">q</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">outList</span><span class="o">=</span><span class="n">inList</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outList</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">outList</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">!=</span><span class="nb">list</span><span class="p">:</span>
                <span class="n">outList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">outList</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">outList</span>

</div>
<div class="viewcode-block" id="writeTEBDfiles"><a class="viewcode-back" href="../../tools.html#pyalps.tools.writeTEBDfiles">[docs]</a><span class="k">def</span> <span class="nf">writeTEBDfiles</span><span class="p">(</span><span class="n">parmsList</span><span class="p">,</span> <span class="n">fileName</span><span class="p">):</span>
    <span class="n">counter</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">nmlList</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">parms</span> <span class="ow">in</span> <span class="n">parmsList</span><span class="p">:</span>
        <span class="n">counter</span><span class="o">+=</span><span class="mi">1</span>
        <span class="c">#Set up the systemSettings portion of the nameList file</span>
        <span class="n">systemSettingsString</span><span class="o">=</span><span class="s">&#39;systemSize=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;L&#39;</span><span class="p">])</span>
        <span class="n">systemSettingsString</span><span class="o">=</span><span class="n">systemSettingsString</span><span class="o">+</span><span class="s">&quot;, Hamitype=&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;MODEL&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;&#39;&quot;</span>
        <span class="n">systemSettingsString</span><span class="o">=</span><span class="n">systemSettingsString</span><span class="o">+</span><span class="s">&quot;, initialState=&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;INITIAL_STATE&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;&#39;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="s">&#39;TAUS&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&#39;, rtp=.false.&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&#39;, rtp=.true.&#39;</span>
        <span class="c">#check for conserved quantum numbers</span>
        <span class="k">if</span> <span class="s">&#39;CONSERVED_QUANTUMNUMBERS&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;MODEL&#39;</span><span class="p">])</span><span class="o">==</span><span class="s">&#39;spin&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parms</span><span class="p">[</span><span class="s">&#39;CONSERVED_QUANTUMNUMBERS&#39;</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;Sz&#39;</span><span class="p">:</span>
                    <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&quot;, qswitch=.true.&quot;</span>
                    <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&quot;, qType=&#39;Sz&#39;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Only Sz may be conserved for spin models!&quot;</span><span class="p">)</span>
                    <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&quot;, qswitch=.false.&quot;</span>
                    <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&quot;, qType=&#39;Sz&#39;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parms</span><span class="p">[</span><span class="s">&#39;CONSERVED_QUANTUMNUMBERS&#39;</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;N&#39;</span><span class="p">:</span>
                    <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&quot;, qswitch=.true.&quot;</span>
                    <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&quot;, qType=&#39;N&#39;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Only N may be conserved for particle models!&quot;</span><span class="p">)</span>
                    <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&quot;, qswitch=.false.&quot;</span>
                    <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&quot;, qType=&#39;N&#39;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&quot;, qswitch=.false.&quot;</span>
            <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&quot;, qType=&#39;Sz&#39;&quot;</span>

        <span class="c">#check for value of conserved quantum number</span>
        <span class="c">#Sz</span>
        <span class="k">if</span> <span class="s">&#39;Sz&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;MODEL&#39;</span><span class="p">])</span><span class="o">==</span><span class="s">&#39;spin&#39;</span><span class="p">:</span>
                <span class="c">#Add L*S to this number to convert it to an integer appropriate for TEBD</span>
                <span class="n">parms</span><span class="p">[</span><span class="s">&#39;Sz&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;L&#39;</span><span class="p">])</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;local_S&#39;</span><span class="p">])</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;Sz&#39;</span><span class="p">])</span>
                <span class="c">#convert to an integer-complain if it doesn&#39;t work</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;Sz&#39;</span><span class="p">])</span><span class="o">==</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;Sz&#39;</span><span class="p">]):</span>
                    <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&quot;, totQ=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;Sz&#39;</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Invalid Sz encountered!&quot;</span><span class="p">)</span>
                    <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&quot;, totQ=0&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Sz only conserved for spin models!&quot;</span><span class="p">)</span>
                <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&quot;, totQ=0&quot;</span>
        <span class="c">#N</span>
        <span class="k">elif</span> <span class="s">&#39;N&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;MODEL&#39;</span><span class="p">])</span><span class="o">==</span><span class="s">&#39;spin&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;N only conserved for particle models!&quot;</span><span class="p">)</span>
                <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&quot;, totQ=0&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&quot;, totQ=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;N&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&quot;, totQ=0&quot;</span>

        <span class="c">#check for openmp threading</span>
        <span class="k">if</span> <span class="s">&#39;NUM_THREADS&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
            <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&#39;, numThr=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;NUM_THREADS&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&#39;, numThr=1&#39;</span>
        <span class="c">#check for rtp chi cutoff</span>
        <span class="k">if</span> <span class="s">&#39;CHI_LIMIT&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
            <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&#39;, chiLimit=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;CHI_LIMIT&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&#39;, chiLimit=100&#39;</span>
        <span class="c">#check for rtp truncation error cutoff</span>
        <span class="k">if</span> <span class="s">&#39;TRUNC_LIMIT&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
            <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&#39;, truncLimit=</span><span class="si">%30.15E</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;TRUNC_LIMIT&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&#39;, truncLimit=1.0E-12&#39;</span>
        <span class="c">#check for rtp truncation error cutoff</span>
        <span class="k">if</span> <span class="s">&#39;SIMID&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
            <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&#39;, simId=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;SIMID&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&#39;, simId=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
        <span class="c">#check for verbose switch</span>
        <span class="k">if</span> <span class="s">&#39;VERBOSE&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
            <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&quot;, print_switch=.&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;VERBOSE&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;.&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&quot;,  print_switch=.false.&quot;</span>
        <span class="n">systemSettingsString</span><span class="o">+=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>

        <span class="c">#Output system settings</span>
        <span class="n">nmlfileName</span><span class="o">=</span><span class="n">fileName</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;.nml&#39;</span>
        <span class="n">nmlfile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">nmlfileName</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;SystemSettings</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">systemSettingsString</span><span class="p">)</span>
        <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;end</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="c">#find out which model</span>
        <span class="n">mymodel</span><span class="o">=</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;MODEL&#39;</span><span class="p">]</span>

        <span class="c">#spin and boson models have additional inputs</span>
        <span class="k">if</span> <span class="n">mymodel</span><span class="o">==</span><span class="s">&#39;spin&#39;</span><span class="p">:</span>
            <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;spinp</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;spin=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;local_S&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;end</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mymodel</span><span class="o">==</span><span class="s">&#39;boson Hubbard&#39;</span><span class="p">:</span>
            <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;bosonp</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;nmax=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;Nmax&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;end</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>


        <span class="c">#if the ground state is the initial state, output itp parameters</span>
        <span class="k">if</span> <span class="n">parms</span><span class="p">[</span><span class="s">&#39;INITIAL_STATE&#39;</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;ground&#39;</span><span class="p">:</span>
            <span class="c">#find out lengths of chi, trunc, and convCriteria, if they exist</span>
            <span class="k">if</span> <span class="s">&#39;ITP_CHIS&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                <span class="c">#convert from strings of the form &#39;[float, float]&#39; to</span>
                <span class="c"># [float, float] etc. for use with vistrails modules</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;ITP_CHIS&#39;</span><span class="p">])</span><span class="o">==</span><span class="nb">str</span><span class="p">:</span>
                    <span class="n">itpChiList</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;ITP_CHIS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">itpChiList</span><span class="o">=</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;ITP_CHIS&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">itpChiList</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&#39;ITP_DTS&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;ITP_DTS&#39;</span><span class="p">])</span><span class="o">==</span><span class="nb">str</span><span class="p">:</span>
                    <span class="n">itpDtList</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;ITP_DTS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">itpDtList</span><span class="o">=</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;ITP_DTS&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">itpDtList</span><span class="o">=</span><span class="p">[</span><span class="mf">0.01</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&#39;ITP_CONVS&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;ITP_CONVS&#39;</span><span class="p">])</span><span class="o">==</span><span class="nb">str</span><span class="p">:</span>
                    <span class="n">itpConvList</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;ITP_CONVS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">itpConvList</span><span class="o">=</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;ITP_CONVS&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">itpConvList</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0E-8</span><span class="p">]</span>
            <span class="n">numItp</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">itpChiList</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">itpChiList</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">numItp</span><span class="o">=</span><span class="mi">1</span>
                <span class="n">itpChiList</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">itpDtList</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">itpDtList</span><span class="o">=</span><span class="p">[</span><span class="mf">0.01</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">itpConvList</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">itpConvList</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0E-8</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">itpDtList</span><span class="p">)</span><span class="o">&gt;</span><span class="n">numItp</span><span class="p">:</span>
                <span class="n">itpChiList</span><span class="p">[</span><span class="n">numItp</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">itpDtList</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">itpChiList</span><span class="p">[</span><span class="n">numItp</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">numItp</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">itpDtList</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">itpDtList</span><span class="p">)</span><span class="o">&lt;</span><span class="n">numItp</span><span class="p">:</span>
                <span class="n">itpDtList</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">itpDtList</span><span class="p">):</span><span class="n">numItp</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">itpDtList</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">itpDtList</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>    
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">itpConvList</span><span class="p">)</span><span class="o">&gt;</span><span class="n">numItp</span><span class="p">:</span>
                <span class="n">itpChiList</span><span class="p">[</span><span class="n">numItp</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">itpDtList</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">itpChiList</span><span class="p">[</span><span class="n">numItp</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">itpDtList</span><span class="p">[</span><span class="n">numItp</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">itpConvList</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">itpDtList</span><span class="p">[</span><span class="n">numItp</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">numItp</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">itpConvList</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">itpConvList</span><span class="p">)</span><span class="o">&lt;</span><span class="n">numItp</span><span class="p">:</span>
                <span class="n">itpConvList</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">itpConvList</span><span class="p">):</span><span class="n">numItp</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">itpConvList</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">itpConvList</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>    
            <span class="n">itpfileName</span><span class="o">=</span><span class="n">fileName</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;_itp.dat&#39;</span>
            <span class="c">#Write itp data to namelist file</span>
            <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;ITPsettings</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;numITP=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">numItp</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;, itpfilename=&#39;&quot;</span><span class="o">+</span><span class="n">itpfileName</span><span class="o">+</span><span class="s">&quot;&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;end</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>

            <span class="c">#Write ITP data to itp file</span>
            <span class="n">itpfile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">itpfileName</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">chiString</span><span class="o">=</span><span class="s">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">itpChiList</span><span class="p">:</span>
                <span class="n">chiString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%16i</span><span class="s">&#39;</span> <span class="o">%</span><span class="n">s</span>
            <span class="n">chiString</span><span class="o">=</span><span class="n">chiString</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">itpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chiString</span><span class="p">)</span>
            <span class="n">dtString</span><span class="o">=</span><span class="s">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">itpDtList</span><span class="p">:</span>
                <span class="n">dtString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span> <span class="o">%</span><span class="n">s</span>
            <span class="n">dtString</span><span class="o">=</span><span class="n">dtString</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">itpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dtString</span><span class="p">)</span>
            <span class="n">convString</span><span class="o">=</span><span class="s">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">itpConvList</span><span class="p">:</span>
                <span class="n">convString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span> <span class="o">%</span><span class="n">s</span>
            <span class="n">convString</span><span class="o">=</span><span class="n">convString</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">itpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">convString</span><span class="p">)</span>
            <span class="n">itpfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c">#Write ITP Hamiltonian parameters to namelist</span>
            <span class="k">if</span> <span class="n">mymodel</span><span class="o">==</span><span class="s">&#39;spin&#39;</span><span class="p">:</span>
                <span class="c">#Set up spin parameters</span>
                <span class="n">myJz</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myJxy</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myH</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myGamma</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myD</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myK</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="k">if</span> <span class="s">&#39;J&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">parms</span><span class="p">[</span><span class="s">&#39;J&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s">&#39;J0&#39;</span><span class="p">:</span>
                        <span class="n">myJz</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;J&#39;</span><span class="p">])</span>
                        <span class="n">myJxy</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;J&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;Jz&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myJz</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;Jz&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;Jxy&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myJxy</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;Jxy&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;H&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myH</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;H&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;Gamma&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myGamma</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;Gamma&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;D&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myD</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;D&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;K&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myK</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">])</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;sp</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">=</span><span class="s">&#39;spinP%Jz=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myJz</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, spinP%Jxy=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myJxy</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, spinP%h=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myH</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, spinP</span><span class="si">%g</span><span class="s">am=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myGamma</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, spinP</span><span class="si">%d</span><span class="s">=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myD</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, spinP%k=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myK</span><span class="p">)</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">itpnmlString</span><span class="p">)</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;end</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mymodel</span><span class="o">==</span><span class="s">&#39;boson Hubbard&#39;</span><span class="p">:</span>
                <span class="c">#Set up boson Hubbard parameters</span>
                <span class="n">myT</span><span class="o">=</span><span class="mf">1.0</span>
                <span class="n">myU</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myV</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myMu</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="k">if</span> <span class="s">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myT</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;U&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myU</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;U&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;V&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myV</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;V&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;mu&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myMu</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;mu&#39;</span><span class="p">])</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;bp</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">=</span><span class="s">&#39;bosonP%mu=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myMu</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, bosonP%t=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myT</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, bosonP%V=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myV</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, bosonP%U=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myU</span><span class="p">)</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">itpnmlString</span><span class="p">)</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;end</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mymodel</span><span class="o">==</span><span class="s">&#39;hardcore boson&#39;</span><span class="p">:</span>
                <span class="c">#Set up boson Hubbard parameters</span>
                <span class="n">myT</span><span class="o">=</span><span class="mf">1.0</span>
                <span class="n">myV</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myMu</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="k">if</span> <span class="s">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myT</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;V&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myV</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;V&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;mu&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myMu</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;mu&#39;</span><span class="p">])</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;hcbp</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">=</span><span class="s">&#39;hcbosonp%mu=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myMu</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, hcbosonp%t=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myT</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, hcbosonp%V=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myV</span><span class="p">)</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">itpnmlString</span><span class="p">)</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;end</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mymodel</span><span class="o">==</span><span class="s">&#39;fermion Hubbard&#39;</span><span class="p">:</span>
                <span class="c">#Set up fermion Hubbard parameters</span>
                <span class="n">myT</span><span class="o">=</span><span class="mf">1.0</span>
                <span class="n">myU</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myV</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myMu</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="k">if</span> <span class="s">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myT</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;U&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myU</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;U&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;V&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myV</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;V&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;mu&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myMu</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;mu&#39;</span><span class="p">])</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;fp</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">=</span><span class="s">&#39;fermiP%mu=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myMu</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, fermiP%t=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myT</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, fermiP%V=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myV</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, fermiP%U=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myU</span><span class="p">)</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">itpnmlString</span><span class="p">)</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;end</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mymodel</span><span class="o">==</span><span class="s">&#39;spinless fermions&#39;</span><span class="p">:</span>
                <span class="c">#Set up spinless fermions parameters</span>
                <span class="n">myT</span><span class="o">=</span><span class="mf">1.0</span>
                <span class="n">myV</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myMu</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="k">if</span> <span class="s">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myT</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;V&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myV</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;V&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;mu&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myMu</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;mu&#39;</span><span class="p">])</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;sfp</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">=</span><span class="s">&#39;sfermiP%mu=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myMu</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, sfermiP%t=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myT</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, sfermiP%V=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myV</span><span class="p">)</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">itpnmlString</span><span class="p">)</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;end</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="c">#If rtp is desired, set up the RTP output files</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="s">&#39;TAUS&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">numQuenches</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="c">#get quench data</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;TAUS&#39;</span><span class="p">])</span><span class="o">==</span><span class="nb">str</span><span class="p">:</span>
                <span class="n">myTaus</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;TAUS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">myTaus</span><span class="o">=</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;TAUS&#39;</span><span class="p">]</span>
            <span class="n">numQuenches</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">myTaus</span><span class="p">)</span>

            <span class="k">if</span> <span class="s">&#39;NUMSTEPS&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;NUMSTEPS&#39;</span><span class="p">])</span><span class="o">==</span><span class="nb">str</span><span class="p">:</span>
                    <span class="n">myNumsteps</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;NUMSTEPS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">myNumsteps</span><span class="o">=</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;NUMSTEPS&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">myNumsteps</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span>

            <span class="k">if</span> <span class="s">&#39;STEPSFORSTORE&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;STEPSFORSTORE&#39;</span><span class="p">])</span><span class="o">==</span><span class="nb">str</span><span class="p">:</span>
                    <span class="n">mySfs</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;STEPSFORSTORE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mySfs</span><span class="o">=</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;STEPSFORSTORE&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mySfs</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>


            <span class="n">numParams</span><span class="o">=</span><span class="p">[]</span>
            
            <span class="c">#find the number of parameters quenched in each quench</span>
            <span class="k">if</span> <span class="s">&#39;POWS&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                <span class="n">myPows</span><span class="o">=</span><span class="n">stringListToList</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;POWS&#39;</span><span class="p">])</span>
                <span class="c">#check if any of the pows are list-valued</span>
                <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">myPows</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">:</span>
                        <span class="n">numParams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">numParams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">myPows</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
                <span class="n">numQuenches</span><span class="o">=</span><span class="mi">1</span>


            <span class="k">if</span> <span class="s">&#39;GIS&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                <span class="n">myGis</span><span class="o">=</span><span class="n">stringListToList</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;GIS&#39;</span><span class="p">])</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">myGis</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
                <span class="n">numQuenches</span><span class="o">=</span><span class="mi">1</span>

            <span class="k">if</span> <span class="s">&#39;GFS&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                <span class="n">myGfs</span><span class="o">=</span><span class="n">stringListToList</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;GFS&#39;</span><span class="p">])</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">myGfs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
                <span class="n">numQuenches</span><span class="o">=</span><span class="mi">1</span>

            <span class="k">if</span> <span class="s">&#39;GS&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                <span class="n">myGs</span><span class="o">=</span><span class="n">stringListToListstring</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;GS&#39;</span><span class="p">])</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">myGs</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">]</span>
                <span class="n">numQuenches</span><span class="o">=</span><span class="mi">1</span>


            <span class="n">rtpfileName</span><span class="o">=</span><span class="n">fileName</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;_rtp.dat&#39;</span>
            <span class="c">#Write rtp data to namelist file</span>
            <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;RTPsettings</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;numQuenches=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">numQuenches</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;, rtpfilename=&#39;&quot;</span><span class="o">+</span><span class="n">rtpfileName</span><span class="o">+</span><span class="s">&quot;&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;end</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="c">#Write RTP data to rtp file</span>
            <span class="n">rtpfile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">rtpfileName</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">tauString</span><span class="o">=</span><span class="s">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">myTaus</span><span class="p">:</span>
                <span class="n">tauString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span> <span class="o">%</span><span class="n">s</span>
            <span class="n">tauString</span><span class="o">=</span><span class="n">tauString</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">rtpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tauString</span><span class="p">)</span>
            <span class="n">nsString</span><span class="o">=</span><span class="s">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">myNumsteps</span><span class="p">:</span>
                <span class="n">nsString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%16i</span><span class="s">&#39;</span> <span class="o">%</span><span class="n">s</span>
            <span class="n">nsString</span><span class="o">=</span><span class="n">nsString</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">rtpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">nsString</span><span class="p">)</span>
            <span class="n">sfsString</span><span class="o">=</span><span class="s">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">mySfs</span><span class="p">:</span>
                <span class="n">sfsString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%16i</span><span class="s">&#39;</span> <span class="o">%</span><span class="n">s</span>
            <span class="n">sfsString</span><span class="o">=</span><span class="n">sfsString</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">rtpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sfsString</span><span class="p">)</span>

            <span class="c">#write the nparams to file</span>
            <span class="n">nParamsString</span><span class="o">=</span><span class="s">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">numParams</span><span class="p">:</span>
                <span class="n">nParamsString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%16i</span><span class="s">&#39;</span> <span class="o">%</span><span class="n">s</span>
            <span class="n">nParamsString</span><span class="o">=</span><span class="n">nParamsString</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">rtpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">nParamsString</span><span class="p">)</span>
            <span class="n">powString</span><span class="o">=</span><span class="s">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">myPows</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                    <span class="n">powString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span> <span class="o">%</span><span class="n">q</span>
                <span class="n">powString</span><span class="o">=</span><span class="n">powString</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">rtpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">powString</span><span class="p">)</span>
            <span class="n">giString</span><span class="o">=</span><span class="s">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">myGis</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                    <span class="n">giString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span> <span class="o">%</span><span class="n">q</span>
                <span class="n">giString</span><span class="o">=</span><span class="n">giString</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">rtpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">giString</span><span class="p">)</span>
            <span class="n">gfString</span><span class="o">=</span><span class="s">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">myGfs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                    <span class="n">gfString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span> <span class="o">%</span><span class="n">q</span>
                <span class="n">gfString</span><span class="o">=</span><span class="n">gfString</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">rtpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">gfString</span><span class="p">)</span>
            <span class="n">gsString</span><span class="o">=</span><span class="s">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">myGs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                    <span class="n">gsString</span><span class="o">+=</span><span class="n">q</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">gsString</span><span class="o">=</span><span class="n">gsString</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">rtpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">gsString</span><span class="p">)</span>
            <span class="n">rtpfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


            <span class="c">#Write RTP Hamiltonian parameters to namelist</span>
            <span class="k">if</span> <span class="n">mymodel</span><span class="o">==</span><span class="s">&#39;spin&#39;</span><span class="p">:</span>
                <span class="c">#Set up spin parameters</span>
                <span class="n">myJz</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myJxy</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myH</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myGamma</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myD</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myK</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="k">if</span> <span class="s">&#39;J&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">parms</span><span class="p">[</span><span class="s">&#39;J&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s">&#39;J0&#39;</span><span class="p">:</span>
                        <span class="n">myJz</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;J&#39;</span><span class="p">])</span>
                        <span class="n">myJxy</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;J&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;Jz&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myJz</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;Jz&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;Jxy&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myJxy</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;Jxy&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;H&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myH</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;H&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;Gamma&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myGamma</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;Gamma&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;D&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myD</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;D&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;K&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myK</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">])</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;sp</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">=</span><span class="s">&#39;spinP%Jz=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myJz</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, spinP%Jxy=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myJxy</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, spinP%h=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myH</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, spinP</span><span class="si">%g</span><span class="s">am=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myGamma</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, spinP</span><span class="si">%d</span><span class="s">=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myD</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, spinP%k=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myK</span><span class="p">)</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">itpnmlString</span><span class="p">)</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;end</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mymodel</span><span class="o">==</span><span class="s">&#39;boson Hubbard&#39;</span><span class="p">:</span>
                <span class="c">#Set up boson Hubbard parameters</span>
                <span class="n">myT</span><span class="o">=</span><span class="mf">1.0</span>
                <span class="n">myU</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myV</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myMu</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="k">if</span> <span class="s">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myT</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;U&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myU</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;U&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;V&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myV</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;V&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;mu&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myMu</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;mu&#39;</span><span class="p">])</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;bp</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">=</span><span class="s">&#39;bosonP%mu=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myMu</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, bosonP%t=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myT</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, bosonP%V=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myV</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, bosonP%U=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myU</span><span class="p">)</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">itpnmlString</span><span class="p">)</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;end</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mymodel</span><span class="o">==</span><span class="s">&#39;hardcore boson&#39;</span><span class="p">:</span>
                <span class="c">#Set up boson Hubbard parameters</span>
                <span class="n">myT</span><span class="o">=</span><span class="mf">1.0</span>
                <span class="n">myV</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myMu</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="k">if</span> <span class="s">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myT</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;V&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myV</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;V&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;mu&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myMu</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;mu&#39;</span><span class="p">])</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;hcbp</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">=</span><span class="s">&#39;hcbosonp%mu=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myMu</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, hcbosonp%t=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myT</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, hcbosonp%V=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myV</span><span class="p">)</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">itpnmlString</span><span class="p">)</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;end</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mymodel</span><span class="o">==</span><span class="s">&#39;fermion Hubbard&#39;</span><span class="p">:</span>
                <span class="c">#Set up fermion Hubbard parameters</span>
                <span class="n">myT</span><span class="o">=</span><span class="mf">1.0</span>
                <span class="n">myU</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myV</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myMu</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="k">if</span> <span class="s">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myT</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;U&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myU</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;U&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;V&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myV</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;V&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;mu&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myMu</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;mu&#39;</span><span class="p">])</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;fp</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">=</span><span class="s">&#39;fermiP%mu=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myMu</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, fermiP%t=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myT</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, fermiP%V=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myV</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, fermiP%U=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myU</span><span class="p">)</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">itpnmlString</span><span class="p">)</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;end</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mymodel</span><span class="o">==</span><span class="s">&#39;spinless fermions&#39;</span><span class="p">:</span>
                <span class="c">#Set up spinless fermions parameters</span>
                <span class="n">myT</span><span class="o">=</span><span class="mf">1.0</span>
                <span class="n">myV</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">myMu</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="k">if</span> <span class="s">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myT</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;V&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myV</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;V&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;mu&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                    <span class="n">myMu</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;mu&#39;</span><span class="p">])</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;sfp</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">=</span><span class="s">&#39;sfermiP%mu=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myMu</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, sfermiP%t=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myT</span><span class="p">)</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;, sfermiP%V=&#39;</span>
                <span class="n">itpnmlString</span><span class="o">+=</span><span class="s">&#39;</span><span class="si">%30.15E</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myV</span><span class="p">)</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">itpnmlString</span><span class="p">)</span>
                <span class="n">nmlfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&amp;end</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">nmlList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nmlfileName</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nmlList</span>
</pre></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../modules.html">Pyalps v2.0.0rc4 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li>
          <li><a href="../pyalps.html" >pyalps</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, ALPS collaboration.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>
  </body>
</html>