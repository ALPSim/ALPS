srcdir = @srcdir@
top_srcdir = @top_srcdir@
builddir = @builddir@
top_builddir = ./@top_builddir@

version = @PACKAGE_VERSION@
distdir = alps-$(version)

SCRIPTS = configure config/install-sh config/makedepend.pl config/mkinstalldirs tool/archivecat tool/transformall tool/xslttransform
ERASE = bootstrap dist TODO

default all libs programs examples tests install uninstall :

release dist check snapshot : Makefile
	@root=`cat $(top_srcdir)/CVS/Root`; \
	repository=`cat $(top_srcdir)/CVS/Repository`; \
	tag=`echo release_$(version) | sed 's/\./_/g'`; \
	if test "$@" = "check"; then tag='HEAD'; fi; \
	if test "$@" = "snapshot"; then tag='HEAD'; fi; \
	version=$(version); \
	if test "$@" = "snapshot"; then version=`date +%Y%m%d`; fi; \
	distdir=@PACKAGE_NAME@-$$version; \
	echo version = $$version; \
	echo tag = $$tag; \
	echo root = $$root; \
	echo repository = $$repository; \
	echo cvs -d $$root -Q export -r $$tag $$repository; \
	cvs -d $$root -Q export -r $$tag $$repository; \
	(cd $$repository && rm -rf $(ERASE)); \
	find $$repository -name .cvsignore | xargs rm -f; \
	find $$repository -type f | xargs chmod 644; \
	find $$repository -type d | xargs chmod 755; \
	(cd $$repository && chmod 755 $(SCRIPTS)); \
	mv -f $$repository $$distdir; \
	mv -f $$distdir/LICENSE-light.txt LICENSE-light.txt; \
	mv -f $$distdir/doc/index-light.html index-light.html; \
	tar chof - $$distdir | gzip -c > $$distdir.tar.gz; \
	\
	lightdir=@PACKAGE_NAME@-light-$$version; \
	mv -f $$distdir $$lightdir; \
	rm -f $$lightdir/CITATIONS.txt; \
	rm -rf $$lightdir/src/alps/alea* $$lightdir/src/alps/lattice* $$lightdir/src/alps/model* $$lightdir/src/alps/scheduler*; \
	rm -rf $$lightdir/tool $$lightdir/example; \
	rm -rf $$lightdir/test/alea $$lightdir/test/lattice  $$lightdir/test/model; \
	rm -rf $$lightdir/doc/alea $$lightdir/doc/lattice $$lightdir/doc/model $$lightdir/doc/scheduler $$lightdir/doc/tool; \
	mv -f LICENSE-light.txt $$lightdir/LICENSE.txt; \
	mv -f index-light.html $$lightdir/doc/index.html; \
	find $$lightdir -type f -name '*\.h' -or -name '*\.C' -or -name '*\.hpp' -or -name '*\.h\.in' | xargs ./update_preamble.pl -l; \
	tar chof - $$lightdir | gzip -c > $$lightdir.tar.gz; \
	\
	rm -rf $$lightdir

boost-snapshot: Makefile
	./make_snapshot boost

boost-sandbox-snapshot: Makefile
	./make_snapshot boost-sandbox

clean :
distclean :
	rm -rf alps-* Makefile

Makefile : $(srcdir)/Makefile.in
	(cd $(top_builddir) && ./config.status)

depend:

update-preamble:
	find ./.. -type f -name '*\.h' -or -name '*\.C' -or -name '*\.hpp' -or -name '*\.h\.in' | xargs ./update_preamble.pl
